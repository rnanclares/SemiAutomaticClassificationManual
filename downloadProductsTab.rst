.. _download_tab:

******************************
Download products 
******************************

.. contents::
    :depth: 2
    :local:
	
.. |registry_save| image:: _static/registry_save.png
	:width: 20pt
	
.. |project_save| image:: _static/project_save.png
	:width: 20pt
	
.. |optional| image:: _static/optional.png
	:width: 20pt
	
.. |input_list| image:: _static/input_list.jpg
	:width: 20pt
	
.. |input_text| image:: _static/input_text.jpg
	:width: 20pt
	
.. |input_date| image:: _static/input_date.jpg
	:width: 20pt
	
.. |input_number| image:: _static/input_number.jpg
	:width: 20pt
	
.. |input_slider| image:: _static/input_slider.jpg
	:width: 20pt
	
.. |input_table| image:: _static/input_table.jpg
	:width: 20pt
	
.. |add| image:: _static/semiautomaticclassificationplugin_add.png
	:width: 20pt
	
.. |checkbox| image:: _static/checkbox.png
	:width: 18pt
	
.. |pointer| image:: _static/semiautomaticclassificationplugin_pointer_tool.png
	:width: 20pt
	
.. |radiobutton| image:: _static/radiobutton.png
	:width: 18pt
	
.. |reload| image:: _static/semiautomaticclassificationplugin_reload.png
	:width: 20pt
	
.. |reset| image:: _static/semiautomaticclassificationplugin_reset.png
	:width: 20pt
	
.. |remove| image:: _static/semiautomaticclassificationplugin_remove.png
	:width: 20pt
	
.. |run| image:: _static/semiautomaticclassificationplugin_run.png
	:width: 24pt
	
.. |open_file| image:: _static/semiautomaticclassificationplugin_open_file.png
	:width: 20pt
	
.. |new_file| image:: _static/semiautomaticclassificationplugin_new_file.png
	:width: 20pt
	
.. |open_dir| image:: _static/semiautomaticclassificationplugin_open_dir.png
	:width: 20pt
	
.. |select_all| image:: _static/semiautomaticclassificationplugin_select_all.png
	:width: 20pt
	
.. |move_up| image:: _static/semiautomaticclassificationplugin_move_up.png
	:width: 20pt
	
.. |add_bandset| image:: _static/semiautomaticclassificationplugin_add_bandset_tool.png
	:width: 20pt
	
.. |move_down| image:: _static/semiautomaticclassificationplugin_move_down.png
	:width: 20pt
	
.. |search_images| image:: _static/semiautomaticclassificationplugin_search_images.png
	:width: 20pt

.. |osm_add| image:: _static/semiautomaticclassificationplugin_osm_add.png
	:width: 20pt

.. |image_preview| image:: _static/semiautomaticclassificationplugin_download_image_preview.png
	:width: 20pt

.. |import| image:: _static/semiautomaticclassificationplugin_import.png
	:width: 20pt
	
.. |export| image:: _static/semiautomaticclassificationplugin_export.png
	:width: 20pt

.. |plus| image:: _static/semiautomaticclassificationplugin_plus.png
	:width: 20pt

.. |order_by_name| image:: _static/semiautomaticclassificationplugin_order_by_name.png
	:width: 20pt

.. |image_overview| image:: _static/semiautomaticclassificationplugin_download_image_overview.png
	:width: 20pt
	
.. |enter| image:: _static/semiautomaticclassificationplugin_enter.png
	:width: 20pt

.. |download| image:: _static/semiautomaticclassificationplugin_download_arrow.png
	:width: 20pt
	
.. |login_data| image:: _static/semiautomaticclassificationplugin_download_login.png
	:width: 20pt
	
.. |search_tab| image:: _static/semiautomaticclassificationplugin_download_search.png
	:width: 20pt

.. |download_options_tab| image:: _static/semiautomaticclassificationplugin_download_options.png
	:width: 20pt

.. |tools| image:: _static/semiautomaticclassificationplugin_roi_tool.png
	:width: 20pt
	
.. |roi_multiple| image:: _static/semiautomaticclassificationplugin_roi_multiple.png
	:width: 20pt

.. |import_spectral_library| image:: _static/semiautomaticclassificationplugin_import_spectral_library.png
	:width: 20pt
	
.. |export_spectral_library| image:: _static/semiautomaticclassificationplugin_export_spectral_library.png
	:width: 20pt
	
.. |weight_tool| image:: _static/semiautomaticclassificationplugin_weight_tool.png
	:width: 20pt
	
.. |LCS_threshold_ROI_tool| image:: _static/semiautomaticclassificationplugin_LCS_threshold_ROI_tool.png
	:width: 20pt
	
.. |threshold_tool| image:: _static/semiautomaticclassificationplugin_threshold_tool.png
	:width: 20pt
	
.. |LCS_threshold| image:: _static/semiautomaticclassificationplugin_LCS_threshold_tool.png
	:width: 20pt
	
.. |LCS_threshold_set_tool| image:: _static/semiautomaticclassificationplugin_LCS_threshold_set_tool.png
	:width: 20pt
	
.. |sign_plot| image:: _static/semiautomaticclassificationplugin_sign_tool.png
	:width: 20pt
	
.. |rgb_tool| image:: _static/semiautomaticclassificationplugin_rgb_tool.png
	:width: 20pt
	
.. |preprocessing| image:: _static/semiautomaticclassificationplugin_class_tool.png
	:width: 20pt
	
.. |band_processing| image:: _static/semiautomaticclassificationplugin_band_processing.png
	:width: 20pt
	
.. |band_combination| image:: _static/semiautomaticclassificationplugin_band_combination_tool.png
	:width: 20pt
	
.. |landsat_tool| image:: _static/semiautomaticclassificationplugin_landsat8_tool.png
	:width: 20pt
	
.. |sentinel2_tool| image:: _static/semiautomaticclassificationplugin_sentinel_tool.png
	:width: 20pt
	
.. |sentinel3_tool| image:: _static/semiautomaticclassificationplugin_sentinel3_tool.png
	:width: 20pt
	
.. |aster_tool| image:: _static/semiautomaticclassificationplugin_aster_tool.png
	:width: 20pt
	
.. |modis_tool| image:: _static/semiautomaticclassificationplugin_modis_tool.png
	:width: 20pt
	
.. |split_raster| image:: _static/semiautomaticclassificationplugin_split_raster.png
	:width: 20pt
	
.. |stack_raster| image:: _static/semiautomaticclassificationplugin_stack_raster.png
	:width: 20pt
	
.. |mosaic_tool| image:: _static/semiautomaticclassificationplugin_mosaic_tool.png
	:width: 20pt
	
.. |cloud_masking_tool| image:: _static/semiautomaticclassificationplugin_cloud_masking_tool.png
	:width: 20pt
	
.. |clip_tool| image:: _static/semiautomaticclassificationplugin_clip_tool.png
	:width: 20pt
	
.. |pca_tool| image:: _static/semiautomaticclassificationplugin_pca_tool.png
	:width: 20pt
	
.. |vector_to_raster_tool| image:: _static/semiautomaticclassificationplugin_vector_to_raster_tool.png
	:width: 20pt
	
.. |post_process| image:: _static/semiautomaticclassificationplugin_post_process.png
	:width: 20pt
	
.. |accuracy_tool| image:: _static/semiautomaticclassificationplugin_accuracy_tool.png
	:width: 20pt
	
.. |land_cover_change| image:: _static/semiautomaticclassificationplugin_land_cover_change.png
	:width: 20pt
	
.. |report_tool| image:: _static/semiautomaticclassificationplugin_report_tool.png
	:width: 20pt

.. |cross_classification| image:: _static/semiautomaticclassificationplugin_cross_classification.png
	:width: 20pt

.. |spectral_distance| image:: _static/semiautomaticclassificationplugin_spectral_distance.png
	:width: 20pt

.. |clustering| image:: _static/semiautomaticclassificationplugin_kmeans_tool.png
	:width: 20pt

.. |class_to_vector_tool| image:: _static/semiautomaticclassificationplugin_class_to_vector_tool.png
	:width: 20pt

.. |class_signature| image:: _static/semiautomaticclassificationplugin_class_signature_tool.png
	:width: 20pt

.. |reclassification_tool| image:: _static/semiautomaticclassificationplugin_reclassification_tool.png
	:width: 20pt

.. |edit_raster| image:: _static/semiautomaticclassificationplugin_edit_raster.png
	:width: 20pt

.. |undo_edit_raster| image:: _static/semiautomaticclassificationplugin_undo_edit_raster.png
	:width: 20pt

.. |classification_sieve| image:: _static/semiautomaticclassificationplugin_classification_sieve.png
	:width: 20pt

.. |classification_erosion| image:: _static/semiautomaticclassificationplugin_classification_erosion.png
	:width: 20pt

.. |classification_dilation| image:: _static/semiautomaticclassificationplugin_classification_dilation.png
	:width: 20pt

.. |bandcalc_tool| image:: _static/semiautomaticclassificationplugin_bandcalc_tool.png
	:width: 20pt
	
.. |batch_tool| image:: _static/semiautomaticclassificationplugin_batch.png
	:width: 20pt

.. |bandset_tool| image:: _static/semiautomaticclassificationplugin_bandset_tool.png
	:width: 20pt
	
.. |settings_tool| image:: _static/semiautomaticclassificationplugin_settings_tool.png
	:width: 20pt

.. |close_bandset| image:: _static/close_bandset.jpg
	:width: 20pt

	
The tab |download| :guilabel:`Download products` includes the tools for searching and downloading free remote sensing images.
Also, automatic conversion to reflectance of downloaded bands is available.
	
An internet connection is required and free registration could be required depending on the download service.

This tool allows for searching and downloading:

* :ref:`Landsat_definition` images (from 1 MSS to 8 OLI) acquired from the 80s to present days;
* :ref:`Sentinel1_definition` images (GRD) acquired from 2014 to present days;
* :ref:`Sentinel2_definition` images (Level-1C and Level-2A) acquired from 2015 to present days;
* :ref:`Sentinel3_definition` images (OLCI  Level-1B OL_1_EFR) acquired from 2016 to present days;
* :ref:`ASTER_definition` images (Level 1T) acquired from 2000 to present days;
* :ref:`MODIS_definition` images (MOD09GQ, MYD09GQ, MOD09GA, MYD09GA, MOD09Q1, MYD09Q1, MOD09A1, MYD09A1) acquired from 2000 to present days;
* :ref:`GOES_definition` images (GOES 16 and GOES 17 Full Disk L1b Radiance) acquired from 2017 to present days;

For Landsat, ASTER, and MODIS the search is performed through the `CMR Search API <https://cmr.earthdata.nasa.gov/search/site/search_api_docs.html>`_ developed by NASA.
Landsat images are freely available through the services: `EarthExplorer <http://earthexplorer.usgs.gov/>`_ , `Google Cloud Storage Landsat <https://cloud.google.com/storage/docs/public-datasets/landsat>`_ .
The ASTER L1T and MODIS products are retrieved from the online Data Pool, courtesy of the NASA Land Processes Distributed Active Archive Center (LP DAAC), USGS/Earth Resources Observation and Science (EROS) Center, Sioux Falls, South Dakota, https://lpdaac.usgs.gov/data_access/data_pool.

GOES products are downloaded through `Amazon AWS Open Data <https://registry.opendata.aws/noaa-goes>`_ .

For Sentinel-1, Sentinel-2, and Sentinel-3 the search is performed through the `Copernicus Open Access Hub <https://scihub.copernicus.eu/>`_ (using the `Data Hub API <https://scihub.copernicus.eu/userguide/5APIsAndBatchScripting>`_ ).
Sentinel-2 are downloaded from `Google Cloud Storage <https://cloud.google.com/storage/docs/public-datasets/sentinel-2>`_ if available.

Please notice that Sentinel products older than 12 months may be archived in `Long Term Archives <https://scihub.copernicus.eu/userguide/LongTermArchive>`_ ) and should be requested through the `Copernicus Open Access Hub <https://scihub.copernicus.eu/>`_ .

This tool attempts to download images first from `Amazon Web Services` and `Google Earth Engine` ; only if images are not available, the download is performed through the services that require to login.

.. _login_data_tab:

Login data
----------------------------------------

.. figure:: _static/login_data.jpg
	:align: center
	:width: 500pt
	
	|login_data| :guilabel:`Login data`

.. _login_usgs:

Login https://ers.cr.usgs.gov
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

For Landsat images `USGS EROS` credentials (https://ers.cr.usgs.gov) are required for downloads from `EarthExplorer <http://earthexplorer.usgs.gov/>`_ .
Login using your `USGS EROS` credentials or register for free at https://ers.cr.usgs.gov/register .

* :guilabel:`User` |input_text| |registry_save|: enter the user name;
* :guilabel:`Password` |input_text| |registry_save|: enter the password;
* |checkbox| :guilabel:`remember`: remember user name and password in QGIS;

.. _login_earthdata:

Login https://urs.earthdata.nasa.gov 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 
For ASTER and MODIS images `EOSDIS Earthdata` credentials (https://urs.earthdata.nasa.gov ) are required for download.
Login using your `EOSDIS Earthdata` credentials or register for free at https://urs.earthdata.nasa.gov/users/new .
Before downloading ASTER and MODIS images, you must approve LP DAAC Data Pool clicking the following link https://urs.earthdata.nasa.gov/approve_app?client_id=ijpRZvb9qeKCK5ctsn75Tg
	
* :guilabel:`User` |input_text| |registry_save|: enter the user name;
* :guilabel:`Password` |input_text| |registry_save|: enter the password;
* |checkbox| :guilabel:`remember`: remember user name and password in QGIS;

.. _login_Sentinel:

Login Sentinels
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

In order to access to Sentinel data a free registration is required at https://scihub.copernicus.eu/userguide/1SelfRegistration (other services may require different registrations).
After the registration, enter the user name and password for accessing data.
	
* :guilabel:`Service` |input_text| |registry_save|: enter the service URL (default is https://scihub.copernicus.eu/apihub); other mirror services that share the same infrastructure can be used (such as https://scihub.copernicus.eu/dhus , https://finhub.nsdc.fmi.fi , https://data.sentinel.zamg.ac.at);
* |reset|: reset the default service;
* :guilabel:`User` |input_text| |registry_save|: enter the user name;
* :guilabel:`Password` |input_text| |registry_save|: enter the password;
* |checkbox| :guilabel:`remember`: remember user name and password in QGIS;

.. _search_tab:

Search
----------------------------------------

.. figure:: _static/search_tab.jpg
	:align: center
	:width: 500pt
	
	|search_tab| :guilabel:`Search`

.. _search_parameters:

Search parameters
^^^^^^^^^^^^^^^^^
	
Define the search area by entering the coordinates (longitude and latitude) of an ``Upper Left`` (UL) point and ``Lower Right`` (LR) point and select a product to search.
Optional settings are date of acquisition, maximum cloud cover, number of results (the less the results, the faster is the query).

The definition of a search area is required before searching the images.
For Sentinel-2 it is possible to avoid the definition of a search by entering a granule name in the :guilabel:`Advanced search` |input_text|. 

* :guilabel:`UL` |input_number| |input_number|: set the UL longitude X (Lon) and the UL latitude Y (Lat);
* :guilabel:`LR` |input_number| |input_number|: set the LR longitude X (Lon) and the LR latitude Y (Lat);
* |radiobutton| :guilabel:`Show`: show or hide the search area in the map;
* |pointer|: define a search area by left click to set the UL point and right click to set the LR point; the search area is displayed in the map;
* :guilabel:`Products` |input_list|: set the search product;
* :guilabel:`Date from` |input_date|: set the starting date of acquisition;
* :guilabel:`to` |input_date|: set the ending date of acquisition;
* :guilabel:`Max cloud cover (%)` |input_number|: maximum cloud cover in the product;
* :guilabel:`Results` |input_number|: maximum number of products returned by the search;
* :guilabel:`Advanced search` |input_text|: some services (e.g. Sentinel-2) allows for entering search parameters; for instance, it is possible to enter the name of a granule (e.g. 33TTG) without defining a search area in order to get the results of that granule; Sentinel-2 level 2A can be filtered entering ``S2A_MSIL2A*`` ;
* :guilabel:`Filter` |input_text|: set a filter such as the Product ID (e.g. ``LC81910312015006LGN00``); it is possible to enter multiple Product IDs separated by comma or semicolon (e.g. ``LC81910312015006LGN00, LC81910312013224LGN00`` ); filter is applied to resulting products in the search area;
* :guilabel:`Find` |search_images|: find the products in the search area; results are displayed inside the table in :ref:`product_list`; results are added to previous results;
* |osm_add| Add OpenStreetMap to the map: this button allows for the display of OpenStreetMap tiles (© `OpenStreetMap <http://www.openstreetmap.org/copyright>`_ contributors) in the QGIS map as described in https://wiki.openstreetmap.org/wiki/QGIS . The cartography is licensed as CC BY-SA (`Tile Usage Policy <http://www.openstreetmap.org/copyright>`_ );

	**TIP**: Search results (and the number thereof) depend on the defined area extent and the range of dates. In order to get more results, perform multiple searches defining smaller area extent and narrow acquisition dates (from and to).
	
.. _product_list:

Product list
^^^^^^^^^^^^^^^^^

The table :guilabel:`Product list` contains the results of the search.
Click on any item (highlight) to display the image preview thereof (not all the products include image previews).
Results are saved with the QGIS project.

* |input_table| :guilabel:`Product list` |project_save|: found products are displayed in this table, which includes the following fields;
	* :guilabel:`Product`: the product name;
	* :guilabel:`ProductID`: the product ID;
	* :guilabel:`AcquisitionDate`: date of acquisition of product;
	* :guilabel:`CloudCover`: percentage of cloud cover in the product;
	* :guilabel:`Zone/Path`: the zone or WRS path depending on the product type;
	* :guilabel:`Row/DayNightFlag`: the WRS row or acquisition flag(day or night) depending on the product type;
	* :guilabel:`min_lat`: minimum latitude of the product;
	* :guilabel:`min_lon`: minimum longitude of the product;
	* :guilabel:`max_lat`: maximum latitude of the product;
	* :guilabel:`max_lon`: maximum longitude of the product;
	* :guilabel:`Collection/Size`: collection code or size depending on the product type;
	* :guilabel:`Preview`: URL of the product preview;
	* :guilabel:`Collection/ID`: collection or image ID depending on the product type;
	* :guilabel:`Collection/Image`: collection or image ID depending on the product type;
	
* |image_preview|: display preview of highlighted images in the map; preview is roughly georeferenced on the fly (not all the products include a preview);
* |remove|: remove highlighted images from the list;
* |reset|: remove all images from the list;
* |import|: import the product list from a text file (i.e. ``.txt``);
* |export|: export the product list to a text file (i.e. ``.txt``);

.. _download:

Download
^^^^^^^^^^^^^^^^^

Download the products in the :ref:`product_list`.
During the download it is recommended not to interact with QGIS.

* |checkbox| :guilabel:`Only if preview in Layers`: if checked, download only those images listed in :ref:`product_list` which are also listed in the QGIS layer panel;
* |checkbox| :guilabel:`Preprocess images`: if checked, bands are automatically converted after the download, according to the settings defined in :ref:`landsat_tab`;
* |checkbox| :guilabel:`Load bands in QGIS`: if checked, bands are loaded in QGIS after the download;
* |export|: export the download links to a text file;
* :guilabel:`RUN` |run|: start the download process of all the products listed in :ref:`product_list`;

.. _download_options:

Download options
----------------------------------------

.. figure:: _static/download_options.jpg
	:align: center
	:width: 500pt
	
	|download_options_tab| :guilabel:`Download options`
		
This tab allows for the selection of single bands for Landsat, Sentinel-2, and Sentinel-3 images.
Depending on the download service, single band download could be unavailable.

* |checkbox| :guilabel:`Band` ``X``: select bands for download;
* |checkbox| :guilabel:`Ancillary data`: if checked, the metadata files are selected for download;
* |select_all|: select or deselect all bands;
