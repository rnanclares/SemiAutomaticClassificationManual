.. _batch_tab:

******************************
Batch
******************************

.. contents::
    :depth: 2
    :local:
	
.. |registry_save| image:: _static/registry_save.png
	:width: 20pt
	
.. |project_save| image:: _static/project_save.png
	:width: 20pt
	
.. |optional| image:: _static/optional.png
	:width: 20pt
	
.. |input_list| image:: _static/input_list.jpg
	:width: 20pt
	
.. |input_text| image:: _static/input_text.jpg
	:width: 20pt
	
.. |input_date| image:: _static/input_date.jpg
	:width: 20pt
	
.. |input_number| image:: _static/input_number.jpg
	:width: 20pt
	
.. |input_slider| image:: _static/input_slider.jpg
	:width: 20pt
	
.. |input_table| image:: _static/input_table.jpg
	:width: 20pt
	
.. |add| image:: _static/semiautomaticclassificationplugin_add.png
	:width: 20pt
	
.. |checkbox| image:: _static/checkbox.png
	:width: 18pt
	
.. |pointer| image:: _static/semiautomaticclassificationplugin_pointer_tool.png
	:width: 20pt
	
.. |radiobutton| image:: _static/radiobutton.png
	:width: 18pt
	
.. |reload| image:: _static/semiautomaticclassificationplugin_reload.png
	:width: 20pt
	
.. |reset| image:: _static/semiautomaticclassificationplugin_reset.png
	:width: 20pt
	
.. |remove| image:: _static/semiautomaticclassificationplugin_remove.png
	:width: 20pt
	
.. |run| image:: _static/semiautomaticclassificationplugin_run.png
	:width: 24pt
	
.. |open_file| image:: _static/semiautomaticclassificationplugin_open_file.png
	:width: 20pt
	
.. |new_file| image:: _static/semiautomaticclassificationplugin_new_file.png
	:width: 20pt
	
.. |open_dir| image:: _static/semiautomaticclassificationplugin_open_dir.png
	:width: 20pt
	
.. |select_all| image:: _static/semiautomaticclassificationplugin_select_all.png
	:width: 20pt
	
.. |move_up| image:: _static/semiautomaticclassificationplugin_move_up.png
	:width: 20pt
	
.. |add_bandset| image:: _static/semiautomaticclassificationplugin_add_bandset_tool.png
	:width: 20pt
	
.. |move_down| image:: _static/semiautomaticclassificationplugin_move_down.png
	:width: 20pt
	
.. |search_images| image:: _static/semiautomaticclassificationplugin_search_images.png
	:width: 20pt

.. |osm_add| image:: _static/semiautomaticclassificationplugin_osm_add.png
	:width: 20pt

.. |image_preview| image:: _static/semiautomaticclassificationplugin_download_image_preview.png
	:width: 20pt

.. |import| image:: _static/semiautomaticclassificationplugin_import.png
	:width: 20pt
	
.. |export| image:: _static/semiautomaticclassificationplugin_export.png
	:width: 20pt

.. |plus| image:: _static/semiautomaticclassificationplugin_plus.png
	:width: 20pt

.. |order_by_name| image:: _static/semiautomaticclassificationplugin_order_by_name.png
	:width: 20pt

.. |image_overview| image:: _static/semiautomaticclassificationplugin_download_image_overview.png
	:width: 20pt
	
.. |enter| image:: _static/semiautomaticclassificationplugin_enter.png
	:width: 20pt

.. |download| image:: _static/semiautomaticclassificationplugin_download_arrow.png
	:width: 20pt
	
.. |login_data| image:: _static/semiautomaticclassificationplugin_download_login.png
	:width: 20pt
	
.. |search_tab| image:: _static/semiautomaticclassificationplugin_download_search.png
	:width: 20pt

.. |download_options_tab| image:: _static/semiautomaticclassificationplugin_download_options.png
	:width: 20pt

.. |tools| image:: _static/semiautomaticclassificationplugin_roi_tool.png
	:width: 20pt
	
.. |roi_multiple| image:: _static/semiautomaticclassificationplugin_roi_multiple.png
	:width: 20pt

.. |import_spectral_library| image:: _static/semiautomaticclassificationplugin_import_spectral_library.png
	:width: 20pt
	
.. |export_spectral_library| image:: _static/semiautomaticclassificationplugin_export_spectral_library.png
	:width: 20pt
	
.. |weight_tool| image:: _static/semiautomaticclassificationplugin_weight_tool.png
	:width: 20pt
	
.. |LCS_threshold_ROI_tool| image:: _static/semiautomaticclassificationplugin_LCS_threshold_ROI_tool.png
	:width: 20pt
	
.. |threshold_tool| image:: _static/semiautomaticclassificationplugin_threshold_tool.png
	:width: 20pt
	
.. |LCS_threshold| image:: _static/semiautomaticclassificationplugin_LCS_threshold_tool.png
	:width: 20pt
	
.. |LCS_threshold_set_tool| image:: _static/semiautomaticclassificationplugin_LCS_threshold_set_tool.png
	:width: 20pt
	
.. |sign_plot| image:: _static/semiautomaticclassificationplugin_sign_tool.png
	:width: 20pt
	
.. |rgb_tool| image:: _static/semiautomaticclassificationplugin_rgb_tool.png
	:width: 20pt
	
.. |preprocessing| image:: _static/semiautomaticclassificationplugin_class_tool.png
	:width: 20pt
	
.. |band_processing| image:: _static/semiautomaticclassificationplugin_band_processing.png
	:width: 20pt
	
.. |band_combination| image:: _static/semiautomaticclassificationplugin_band_combination_tool.png
	:width: 20pt
	
.. |landsat_tool| image:: _static/semiautomaticclassificationplugin_landsat8_tool.png
	:width: 20pt
	
.. |sentinel2_tool| image:: _static/semiautomaticclassificationplugin_sentinel_tool.png
	:width: 20pt
	
.. |sentinel3_tool| image:: _static/semiautomaticclassificationplugin_sentinel3_tool.png
	:width: 20pt
	
.. |aster_tool| image:: _static/semiautomaticclassificationplugin_aster_tool.png
	:width: 20pt
	
.. |modis_tool| image:: _static/semiautomaticclassificationplugin_modis_tool.png
	:width: 20pt
	
.. |split_raster| image:: _static/semiautomaticclassificationplugin_split_raster.png
	:width: 20pt
	
.. |stack_raster| image:: _static/semiautomaticclassificationplugin_stack_raster.png
	:width: 20pt
	
.. |mosaic_tool| image:: _static/semiautomaticclassificationplugin_mosaic_tool.png
	:width: 20pt
	
.. |cloud_masking_tool| image:: _static/semiautomaticclassificationplugin_cloud_masking_tool.png
	:width: 20pt
	
.. |clip_tool| image:: _static/semiautomaticclassificationplugin_clip_tool.png
	:width: 20pt
	
.. |pca_tool| image:: _static/semiautomaticclassificationplugin_pca_tool.png
	:width: 20pt
	
.. |vector_to_raster_tool| image:: _static/semiautomaticclassificationplugin_vector_to_raster_tool.png
	:width: 20pt
	
.. |post_process| image:: _static/semiautomaticclassificationplugin_post_process.png
	:width: 20pt
	
.. |accuracy_tool| image:: _static/semiautomaticclassificationplugin_accuracy_tool.png
	:width: 20pt
	
.. |land_cover_change| image:: _static/semiautomaticclassificationplugin_land_cover_change.png
	:width: 20pt
	
.. |report_tool| image:: _static/semiautomaticclassificationplugin_report_tool.png
	:width: 20pt

.. |cross_classification| image:: _static/semiautomaticclassificationplugin_cross_classification.png
	:width: 20pt

.. |spectral_distance| image:: _static/semiautomaticclassificationplugin_spectral_distance.png
	:width: 20pt

.. |clustering| image:: _static/semiautomaticclassificationplugin_kmeans_tool.png
	:width: 20pt

.. |class_to_vector_tool| image:: _static/semiautomaticclassificationplugin_class_to_vector_tool.png
	:width: 20pt

.. |class_signature| image:: _static/semiautomaticclassificationplugin_class_signature_tool.png
	:width: 20pt

.. |reclassification_tool| image:: _static/semiautomaticclassificationplugin_reclassification_tool.png
	:width: 20pt

.. |edit_raster| image:: _static/semiautomaticclassificationplugin_edit_raster.png
	:width: 20pt

.. |undo_edit_raster| image:: _static/semiautomaticclassificationplugin_undo_edit_raster.png
	:width: 20pt

.. |classification_sieve| image:: _static/semiautomaticclassificationplugin_classification_sieve.png
	:width: 20pt

.. |classification_erosion| image:: _static/semiautomaticclassificationplugin_classification_erosion.png
	:width: 20pt

.. |classification_dilation| image:: _static/semiautomaticclassificationplugin_classification_dilation.png
	:width: 20pt

.. |bandcalc_tool| image:: _static/semiautomaticclassificationplugin_bandcalc_tool.png
	:width: 20pt
	
.. |batch_tool| image:: _static/semiautomaticclassificationplugin_batch.png
	:width: 20pt

.. |bandset_tool| image:: _static/semiautomaticclassificationplugin_bandset_tool.png
	:width: 20pt
	
.. |settings_tool| image:: _static/semiautomaticclassificationplugin_settings_tool.png
	:width: 20pt

.. |close_bandset| image:: _static/close_bandset.jpg
	:width: 20pt

.. |check| image:: _static/semiautomaticclassificationplugin_batch_check.png
	:width: 20pt


.. figure:: _static/batch_tab.jpg
	:align: center
	:width: 500pt
	
	|batch_tool| :guilabel:`Batch`
		
This tab allows for the automatic execution (batch) of several :guilabel:`SCP` functions using a scripting interface.

.. _batch_tools:

Batch
-------------------

Enter a batch expression; each function must be in a new line.
Functions have the following structure::

	function name; function options
	
Each function has options, identified by a name, with the following structure::

	option name: option argument
	
Options must be separated by the character ``;`` .
Each function option represents an option in the corresponding interface of :guilabel:`SCP`; option arguments of type text must be between the character ``'`` ; in case of checkboxes, the value 1 represents checked, while the value 0 represents unchecked.
A new line beginning with ``#`` can be used for commenting.

According to the function, some of the options are mandatory while other options can be omitted from the expression.
Option names that contain ``path`` require the full path to a file.

Some options require multiple arguments such as lists; lists must be separated by ``,`` .

* |reset|: clear the expression;
* |export|: export the batch expression to a file;
* |import|: import a previously saved batch expression from file;

A panel :guilabel:`Functions` is displayed at the right side; double click to insert a function in the expression; the following functions are available with the corresponding options:

.. _batch_band_set:

Band set
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* :guilabel:`add_new_bandset`: add a new empty band set; optionally it is possible to specify the position of the added band set (e.g. band_set : 1)::
	
	add_new_bandset;band_set : 1
	
* :guilabel:`add_raster`: add a raster to QGIS, and optionally to an existing band set defining the wavelength::

	add_raster;input_raster_path : '';input_raster_name : '';band_set : 1;center_wavelength : 1
	
* :guilabel:`create_bandset`: create a :guilabel:`Band set` assigning bands; it is possible to enter the satellite name as ``center_wavelength`` option (satellite name as displayed in :guilabel:`Wavelength quick settings` e.g. ``center_wavelength : 'sentinel-2'`` or ``center_wavelength : 'landsat 8'``) to set the corresponding band wavelength center automatically for all the bands; ``raster_path_list`` option accepts a directory and a file name filter separated by comma (e.g. ``raster_path_list : '/home/user, tif'``) to load all the raster inside the directory::
	
	create_bandset;raster_path_list : '';center_wavelength : '';wavelength_unit : 1;multiplicative_factor : '';additive_factor : '';date : ''
	
* :guilabel:`open_training_input`: open a training input file::
	
	open_training_input;training_file_path : ''
	
* :guilabel:`remove_band_from_bandset`: remove a list band from band set by the number thereof (e.g. ``remove_band_from_bandset;band_set : 1;band_list : '1, 2'``)::
	
	remove_band_from_bandset;band_set : 1;band_list : ''
	
* :guilabel:`remove_bandset`: remove a band set by the number thereof::
	
	remove_bandset;band_set : 1
	
* :guilabel:`select_bandset`: select a band set (:guilabel:`active band set`) by the number thereof::
	
	select_bandset;band_set : 1

.. _batch_band_calculation:

Band calculation
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* :ref:`band_calc_tab`: band calculation::
	
	band_calc;expression : '';output_raster_path : '';extent_same_as_raster_name : '';align : 1;extent_intersection : 1;input_nodata_as_value : 0;use_value_nodata : 0;output_nodata_value : -32768;data_type : 'Float32';scale_value : 1;offset_value : 0;band_set : 1

.. _batch_preprocessing:

Preprocessing
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* :ref:`aster_tab`: ASTER conversion::
	
	aster_conversion;input_raster_path : '';celsius_temperature : 0;apply_dos1 : 0;use_nodata : 1;nodata_value : 0;create_bandset : 1;output_dir : '';band_set : 1
	
* :ref:`clip_multiple_rasters_tab`: clip multiple rasters::
	
	clip_multiple_rasters;band_set : 1;output_dir : '';use_vector : 0;vector_path : '';use_vector_field : 0;vector_field : '';ul_x : '';ul_y : '';lr_x : '';lr_y : '';nodata_value : 0;output_name_prefix : 'clip'

* :ref:`cloud_masking_tab`: cloud masking::
	
	cloud_masking;band_set : 1;input_raster_path : '';class_values : '';use_buffer : 1;size_in_pixels : 1;nodata_value : 0;output_name_prefix : 'mask';output_dir : ''
	
* :ref:`goes_tab`: GOES conversion::
	
	goes_conversion;input_dir : '';use_nodata : 1;nodata_value : 0;create_bandset : 1;output_dir : '';band_set : 1

* :ref:`landsat_tab`: Landsat conversion::
	
	landsat_conversion;input_dir : '';mtl_file_path : '';celsius_temperature : 0;apply_dos1 : 0;use_nodata : 1;nodata_value : 0;pansharpening : 0;create_bandset : 1;output_dir : '';band_set : 1

* :ref:`modis_tab`: MODIS conversion::
	
	modis_conversion;input_raster_path : '';reproject_wgs84 : 1;use_nodata : 1;nodata_value : -999;create_bandset : 1;output_dir : '';band_set : 1
	
* :ref:`mosaic_bandsets_tab`: mosaic band sets::
	
	mosaic_bandsets;band_set_list : '';output_dir : '';output_name_prefix : 'mosaic'
	
* :ref:`neighbor_pixels_tab`: neighbor pixels::
	
	neighbor_pixels;band_set : 1;matrix_size : 1;circular : 0;matrix_file_path : '';output_name_prefix : 'neighbor';statistic : 'sum';stat_value : 50;output_dir : ''
	
* :ref:`reproject_raster_bands_tab`: reproject raster bands::
	
	reproject_raster_bands;band_set : 1;output_dir : '';align_raster_path : '';same_extent_reference : 0;epsg : '';x_resolution : '';y_resolution : '';resample_pixel_factor : '';resampling_method : 'near';output_nodata_value : -32768;data_type : 'auto';output_name_prefix : 'reproj'
	
* :ref:`sentinel1_tab`: Sentinel-1 conversion::
	
	sentinel1_conversion;input_raster_path : '';xml_file_path : '';vh : 1;vv : 1;raster_project : 0;raster_projections_band_set : 1;convert_to_db : 1;use_nodata : 1;nodata_value : 0;create_bandset : 1;output_dir : '';band_set : 1

* :ref:`sentinel2_tab`: Sentinel-2 conversion::
	
	sentinel2_conversion;input_dir : '';mtd_safl1c_file_path : '';apply_dos1 : 0;preprocess_bands_1_9_10 : 0;use_nodata : 1;nodata_value : 0;create_bandset : 1;output_dir : '';band_set : 1

* :ref:`sentinel3_tab`: Sentinel-3 conversion::
	
	sentinel3_conversion;input_dir : '';apply_dos1 : 0;use_nodata : 1;nodata_value : 0;create_bandset : 1;output_dir : '';band_set : 1
		
* :ref:`vector_to_raster_tab`: convert vector to raster::
	
	vector_to_raster;vector_file_path : '';use_value_field : 1;vector_field_name : '';constant_value : 1;reference_raster_path : '';type_of_conversion : 'Center of pixels';output_raster_path : ''
	
* :ref:`split_raster_tab`: split raster to single bands::
	
	split_raster_bands;input_raster_path : '';output_dir : '';output_name_prefix : 'split'
		
* :ref:`stack_raster_tab`: stack rasters into a single file::
	
	stack_raster_bands;band_set : 1;output_raster_path : ''

.. _batch_band_processing:

Band processing
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* :ref:`band_combination_tab`: band combination::

	band_combination;band_set : 1;output_raster_path : ''
	
* :ref:`classification_tab`: perform classification::

	classification;band_set : 1;use_macroclass : 0;algorithm_name  : 'Minimum Distance';use_lcs : 0;use_lcs_algorithm : 0;use_lcs_only_overlap : 0;apply_mask : 0;mask_file_path : '';vector_output : 0;classification_report : 0;save_algorithm_files : 0;output_classification_path : ''
	
* :ref:`clustering_tab`: clustering::

	clustering;band_set : 1;clustering_method : 1;use_distance_threshold : 1;threshold_value : 0.0001;number_of_classes : 10;max_iterations : 10;isodata_max_std_dev : 0.0001;isodata_min_class_size : 10;use_nodata : 0;nodata_value : 0;seed_signatures : 1;distance_algorithm : 1;save_signatures : 0;output_raster_path : ''
	
* :ref:`pca_tab`: Principal Component Analysis::

	pca;band_set : 1;use_number_of_components : 0;number_of_components : 2;use_nodata : 1;nodata_value : 0;output_dir : ''
	
* :ref:`random_forest_tab`: Random Forest classification::

	random_forest;band_set : 1;use_macroclass : 1;number_training_samples : 5000;number_trees : 10;evaluate_classifier : 0;evaluate_feature_power_set : 0;min_power : 2;max_power : 7;save_classifier : 0;classifier_file_path : '';output_classification_path : ''
	
* :ref:`spectral_distance_tab`: spectral distance of band sets::

	spectral_distance;first_band_set : 1;second_band_set : 2;distance_algorithm  : 1;use_distance_threshold : 1;threshold_value : 0.1;output_raster_path : ''
	
.. _batch_post_processing:

Post processing
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* :ref:`accuracy_tab`: calculate accuracy::

	accuracy;classification_file_path : '';reference_file_path : '';vector_field_name : '';output_raster_path : '';use_value_nodata : 0
	
* :ref:`class_signature_tab`: class signature::

	class_signature;input_raster_path : '';band_set : 1;save_signatures : 1;output_text_path : ''
	
* :ref:`classification_dilation_tab`: dilation of a classification::

	classification_dilation;input_raster_path : '';class_values : '';size_in_pixels : 1;circular : 0;output_raster_path : ''
	
* :ref:`classification_erosion_tab`: erosion of a classification::

	classification_erosion;input_raster_path : '';class_values : '';size_in_pixels : 1;circular : 0;output_raster_path : ''
	
* :ref:`classification_report_tab`: report of a classification::

	classification_report;input_raster_path : '';use_nodata : 0;nodata_value : 0;output_report_path : ''
	
* :ref:`classification_sieve_tab`: classification sieve::

	classification_sieve;input_raster_path : '';size_threshold : 2;pixel_connection : 4;output_raster_path : ''
	
* :ref:`classification_vector_tab`: convert classification to vector::

	classification_to_vector;input_raster_path : '';use_signature_list_code : 0;code_field : 'C_ID';dissolve_output : 0;output_vector_path : ''
	
* :ref:`cross_classification_tab`: cross classification::

	cross_classification;classification_file_path : '';use_nodata : 0;nodata_value : 0;reference_file_path : '';vector_field_name : '';output_raster_path : ''
	
* :ref:`edit_raster_tab`: edit raster values using a vector::

	edit_raster_using_vector;input_raster_path : '';input_vector_path : '';vector_field_name : '';constant_value : 0;expression :  'where(raster == 1, 2, raster)'
	
* :ref:`land_cover_change_tab`: calculate land cover change::

	land_cover_change;reference_raster_path : '';new_raster_path : '';output_raster_path : ''
	
* :ref:`reclassification_tab`: raster reclassification::

	reclassification;input_raster_path : '';value_list : 'oldVal_newVal,oldVal_newVal';use_signature_list_code : 1;code_field : 'MC_ID';output_raster_path : ''
	
* :ref:`zonal_stat_raster_tab`: calculate zonal statistics related to an input raster::

	zonal_stat_raster;input_raster_path : '';reference_file_path : '';use_nodata : 0;nodata_value : 0;vector_field_name : '';statistic : 'sum';stat_value : 50;output_raster_path : ''

.. _batch_variables:

Variables
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

**Working directory**

* :guilabel:`!working_dir!`: set a working directory (argument is the path to a directory)::

	!working_dir!;''
		
If a working directory is defined, ``!working_dir!`` can be entered in other functions where a path is required (e.g. ``add_raster;input_raster_path : '!working_dir!/raster1.tif';input_raster_name : 'raster1.tif'``).
An example of batch expression is::

	!working_dir!; '/home/user/Desktop/temp/'
	add_raster;input_raster_path : '!working_dir!/raster1.tif';input_raster_name : 'raster1.tif'
	band_calc;expression : 'where("raster1.tif" > 1, 1,0)';output_raster_path : '!working_dir!/calc1.tif';input_nodata_as_value : 1;use_value_nodata : 0
	band_calc;expression : '"raster1.tif" * "calc1.tif"';output_raster_path : '!working_dir!/calc2.tif';extent_intersection : 0
	
**Iterate directories**

* :guilabel:`!for_directory_in!`: function to iterate commands for all the directories in a directory path (e.g. ``!for_directory_in!;'directoryPath'``)::
	
	!for_directory_in!;''
	
The variables !directory_name! can be used to reference the current directory name and !directory! for the current directory path.

The iterated commands must terminate with a line ``!end_for_directory!``; for instance the following script performs Sentinel-2 conversion of all the subdirectories of ``/home/user/``::
	
	!for_directory_in!;'/home/user/'
	sentinel2_conversion;input_dir : '!directory!';create_bandset : 1;output_dir : '!directory!_converted'
	!end_for_directory!

Optionally a filter (i.e. only directories matching the filter will be processed) can be defined for the subdirectory level; the following examples stop the iteration at level 2::

	!for_directory_in!;'/home/user/';2
	
A name filter can be set; for instance the following script creates a band set for every subdirectory having ``rt`` in the name::

	!for_directory_in!;'/home/user/';'rt'
	add_new_bandset;
	create_bandset;raster_path_list : '!directory!, tif';center_wavelength : 'landsat 8';
	!end_for_directory!
	
Multiple name filters can be set separated by character ``|`` such as::

	!for_directory_in!;'/home/user/';3;'name1|name2')

It is possible to filter by date if the directory name ends with a date (format yyyy-mm-dd) using a range separated by colon::

	!for_directory_in!;'/home/user/';2020-01-01:2020-03-31
	sentinel2_conversion;input_dir : '!directory!';create_bandset : 1;output_dir : '!directory!_converted'
	!end_for_directory!
	
* :guilabel:`!directory!`: variable to be used with ``!for_directory_in!`` to reference current directory path::

	!directory!
	
* :guilabel:`!directory_name!`: variable to be used with ``!for_directory_in!`` to reference current directory name::

	!directory_name!
	
* :guilabel:`!end_for_directory!`: ending line to be used with ``!for_directory_in!`` to close the iterative commands::

	!end_for_directory!
	
**Iterate files**
	
* :guilabel:`!for_file_in!`: function to iterate commands for all the files in a directory path (e.g. ``!for_file_in!;'directoryPath'``)::
	
	!for_file_in!;''
	
The variable !file! can be used to reference the current file path.

The iterated commands must terminate with a line ``!end_for_file!``, for instance::

	!for_file_in!;'/home/user/'
	create_bandset;raster_path_list : '!file!';
	!end_for_file!

Optionally a filter (i.e. only directories matching the filter will be processed) can be defined for the subdirectory level; the following examples stop the iteration at level 0::

	!for_file_in!;'/home/user/';0
	
Also, a file name filter can be defined::

	!for_file_in!;'/home/user/';0;'tif'

Multiple name filters can be set separated by character ``|`` such as::

	!for_file_in!;'/home/user/';0;'jp2|tif' 

It is possible to filter by date if the file name ends with a date (format yyyy-mm-dd) using a range::

	!for_file_in!;'/home/user/';2020-01-01:2020-03-31 

Also !file_directory! can be used to refer to the parent directory of the file.
	
* :guilabel:`!file!`: variable to be used with ``!for_file_in!`` to reference current file path::

	!file!
	
* :guilabel:`!file_directory!`: variable to be used with ``!for_file_in!`` to reference the directory containing current file path::

	!file_directory!
	
* :guilabel:`!end_for_file!`: ending line to be used with ``!for_file_in!`` to close the iterative commands::

	!end_for_file!
	
**Iterate band sets**

* :guilabel:`!for_band_set!`: function to iterate commands for all the band sets in a range (e.g. ``!for_band_set!;bandsetNumbers``)::

	!for_band_set!;''
	

It is possible to enter a list of numbers (separated by commas), a range separated by colon, or a list of ranges, for instance::

	!start_for_band_set!;'2:3'
	add_new_bandset;band_set : !bandset_number! 
	!end_for_band_set!
	
* :guilabel:`!bandset_number!`: variable to be used with ``!for_band_set!`` to reference band set number;

* :guilabel:`!end_for_band_set!`: ending line to be used with ``!for_band_set!``;
	
	
**Custom variables**

* :guilabel:`!customVariableName!`: it is possible to create custom variables entering a line such as ``!customVariableName! = value`` (value can be either number or text), that will be replaced in the following parts of the batch script (the variable name cannot be any of the program Batch variables); for instance::

	!number! = 20
	!path_to_file! = /home/file.tif
	add_new_bandset;band_set : !number!
	band_combination;band_set : 1;output_raster_path : '!path_to_file!'
	
**Temporary output**

* :guilabel:`!temp_raster_1!`: create a temporary raster path (saved in the temporary directory) to be used with other functions::

	!temp_raster_1!

``!temp_raster_1!`` can be used as temporary output for other functions such as::

	band_calc;expression : '"raster1"';output_raster_path : '!temp_raster_1!'
	
Additional temporary output can be entered manually, replacing ``1`` with any number or string (e.g. !temp_raster_2! or !temp_raster_calculation! ).
The actual raster name will be the string between ``!`` , for instance temp_raster_1 is the raster name of variable ``!temp_raster_1!``.

.. _batch_qgis_processing:

QGIS Processing
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* :guilabel:`qgis_processing`: use a `QGIS Processing algorithm <https://docs.qgis.org/3.10/en/docs/user_manual/processing_algs/index.html>`_ entering a command (algorithm name) and parameters (without brackets) as described in the `QGIS console <https://docs.qgis.org/3.10/en/docs/user_manual/processing/console.html>`_ ::

	qgis_processing;command : '';parameters : '';load_results : 1

For instance the following command executes GRASS vector dissolve::

	qgis_processing;command : 'grass7:v.dissolve';parameters : 'input': '/home/user/vector.shp','column':'DN','output':'/home/user/output_vector.shp','GRASS_OUTPUT_TYPE_PARAMETER':0
	
It is possible to use the Batch :ref:`batch_variables` for setting input or output paths.
	
.. _batch_run:

Run
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* :guilabel:`CHECK` |check|: check if expression syntax is correct; if expression is correct then the text color is green, red otherwise; in case of error, a label is displayed with a brief description of the error; 
* :guilabel:`RUN` |run|: check if expression syntax is correct and start the batch processes; 
